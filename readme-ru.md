---

# API Управления Салонами

Это RESTful API для управления салонами, разработанное с использованием Node.js, Express, MySQL и Docker. API позволяет выполнять операции CRUD с данными салонов, включая возможность заполнять начальные данные, получать информацию о салонах и многое другое.

## Функции

- Базовая аутентификация для безопасного доступа.
- База данных на MySQL для хранения данных о салонах и рабочем времени.
- Роуты API для управления салонами (`/api/salons`).
- Эндпоинт для заполнения базы данных начальными данными.
- Поддержка CORS.
- Логирование запросов с использованием Morgan.
- Поддержка Docker для простого развертывания.

## Требования

Перед запуском проекта убедитесь, что на вашем компьютере установлены:

- [Node.js](https://nodejs.org/)
- [MySQL](https://www.mysql.com/)

## Настройка и установка

1. Клонируйте репозиторий:

   ```bash
   git clone https://github.com/p-force/salon-management-api.git
   cd salon-management-api
   ```

2. Установите зависимости:

   ```bash
   npm install
   ```

3. Создайте файл `.env` на основе `.env.example`:

   ```bash
   cp .env.example .env
   ```

   Заполните необходимые значения для базы данных и учетных данных для базовой аутентификации.

4. **Настройка базы данных:**

   Убедитесь, что ваша база данных MySQL настроена и доступна. Для создания необходимых таблиц используйте файл `dump.sql`:

   ```bash
   mysql -u DB_USER -h DB_HOST -P DB_PORT -p DB_DATABASE < dump.sql
   ```

   Замените `DB_USER`, `DB_HOST`, `DB_PORT` и `DB_DATABASE` на соответствующие значения из вашего файла `.env`.

5. Запустите сервер:

   ```bash
   npm start
   ```

   API будет доступно по адресу `http://localhost:8080` (или на порту, указанном в файле `.env`).

## Эндпоинты API

### Аутентификация

Для всех роутов API включена базовая аутентификация. Учетные данные задаются в файле `.env` в переменных `BASIC_AUTH_LOGIN` и `BASIC_AUTH_PASSWORD`.

### `/api/salons`

- **GET** `/api/salons` - Получить список всех салонов.
- **GET** `/api/salons/:id` - Получить подробную информацию о конкретном салоне по ID.
- **GET** `/api/salons/random/:count?` - Получить случайный салон или случайный выбор салонов (по умолчанию 1).
- **GET** `/api/salons/seed` - Заполнить базу данных примерными данными.

### `/logout`

- **GET** `/logout` - Выйти из системы (аннулировать сессию, ответ с кодом 401).

### Обработка ошибок

- **404** - Все неподтвержденные маршруты возвращают ответ с кодом 404.

## Поддержка Docker

Проект включает в себя `Dockerfile` и `amvera.yaml` для развертывания проекта на платформе [Amvera](https://amvera.ru/). Для развертывания проекта с помощью Docker выполните следующие шаги.

## Схема базы данных

База данных состоит из двух таблиц:

- **salons**

  - `id`:  Integer, Auto Increment, Primary Key
  - `name`: String, Not Null
  - `address`: String, Not Null
  - `phone`: String, Not Null
  - `image_url`: String

- **working_hours**

  - `id`: Integer, Auto Increment, Primary Key
  - `salon_id`: Integer, Foreign Key to `salons.id`
  - `open_time`: Time
  - `close_time`: Time

## Структура проекта

- **src/database/Database.js** - Логика подключения к базе данных и методы для взаимодействия с базой данных.
- **src/routes/index.js** - Определение роутов API и подключение их к базе данных.
- **.env** - Конфигурационный файл для переменных окружения, таких как учетные данные для базы данных и базовой аутентификации.
- **Dockerfile** - Файл, используемый для сборки Docker-образа для приложения.
- **amvera.yaml** - Конфигурация для развертывания приложения на платформе Amvera.

## Лицензия

Этот проект лицензирован по лицензии MIT - см. файл [LICENSE](LICENSE) для подробностей.

--- 
